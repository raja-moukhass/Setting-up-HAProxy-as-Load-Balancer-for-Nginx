        - name: install dependencies
          apt:
            name: "{{item}}"
            state: present
            update_cache: yes
          loop:
            - apt-transport-https
            - ca-certificates
            - curl
            - gnupg-agent
            - software-properties-common
        - name: add GPG key
          apt_key:
            url: https://download.docker.com/linux/debian/gpg
            state: present
        - name: add docker repository
          apt_repository:
            repo: deb https://download.docker.com/linux/debian bullseye stable
            state: present
        - name: Update packages
          apt:
            update_cache: yes
        - name: install docker
          apt:
            name: "{{item}}"
            state: latest
            update_cache: yes
          loop:
            - docker-ce
            - docker-ce-cli
            - containerd.io
        - name: make sure docker is active
          service:
            name: docker
            state: started
            enabled: yes
        - name: Add  user to "docker" group
          user:
            name: ubuntu
            groups: "docker"
            append: yes    
            
        - name: chmod 666 /var/run/docker.sock
          shell: chmod 666 /var/run/docker.sock
          become: true
